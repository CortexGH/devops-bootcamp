---
docs/5-release-management/5.3.2-maven-integration.md:
  category: CI/CD
  estReadingMinutes: 30
  exercises:
    -
      name: Maven Integration
      description: Get an introduction into how Maven interacts with Artifactory and how to use Maven in GitHub Actions. Fork several projects, use GitHub Actions to create GitHub workflow jobs that build these projects, deploy artifacts to Artifactory, set up jobs to build on commit, make changes and observe the results.
      estMinutes: 240
      technologies:
      - Maven
      - GitHub Actions
      - Artifactory
---

# Maven Releases

Let's bring this all together and think about the process of releasing software.

Imagine PetClinic, Joda-Time, and Junit being maintained by 3 different teams working towards the same production release date.

One thing that is very important in software delivery is to know the exact version of all artifacts being released. Archive the versions with Maven.

Everything that will be released (including dependencies) must be release versions, not SNAPSHOT's.

Here are two ways of doing this.

- Using the [Maven release plugin](http://maven.apache.org/maven-release/maven-release-plugin/) with Maven CLI.
- Using the [Third-Party Maven release GitHub Action](https://github.com/marketplace/actions/java-maven-release) to release artifacts as part of the GitHub workflow.

## Reading

- [Maven Release Plugin: The Final Nail in the Coffin](https://axelfontaine.com/blog/final-nail.html) by Axel Fontaine
- [Building and testing Java with Maven (GitHub Actions)](https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven)

## Exercise - Maven Integration

This section is designed to give you an introduction into how Maven interacts with Artifactory and how to use Maven in GitHub Actions.

1. Fork spring-petclinic, joda-time hibernate, and junit.
2. Setup your local Artifactory for storing artifacts for all three repositories.  
3. Using Maven CLI, build and deploy the snapshot artifacts to Artifactory.
    - Double check the location you are deploying to (as defined by your Maven snapshot and release repository settings).
4. Create GitHub Actions workflow to build and deploy artifacts to Artifactory on commits to the remote repository.
    - Make sure to expose local Artifactory with ngrok so GitHub runners can reach it
5. Mess with things, and see what happens.
    - Make some changes to code.
    - Change some of the versions.
6. Change one of the versions to a release version.
7. Validate the deployments to the Artifactory Releases repository worked.
8. Attempt to deploy that same release version again.
9. Create GitHub Action jobs build dependent projects build when dependency artifacts are built and deployed successfully.

## Exercise - Confirming Version in Artifactory

1. Download the latest version of spring-petclinic from your Artifactory repository.
2. Open up the WAR file.
3. Find the joda-time hibernate library inside the WAR file.
4. What version are you getting? Check with your lead to ensure this is the correct version.
5. Clone joda-time-hibernate and verify the [buildnumber-maven-plugin](http://www.mojohaus.org/buildnumber-maven-plugin/usage.html) is included so two values are added to the Maven metadata file.
    - SCM Revision Number and Build Timestamp

![river image](img5/river_light.svg ':size=100x100 :class=light-mode-icon :alt= river image; light mode')
![river image](img5/river_dark.svg ':size=100x100 :class=dark-mode-icon :alt= river image; dark mode')

## Tips

- Make sure you are adding the necessary plugin defnitions to the pom.xml for the Maven goals you are trying to execute.
- Make sure to be creating Maven jobs in GitHub Actions.
- Is the GitHub Actions job using the correct `settings.xml`? Are you sure?
- What does the ID in the Distribution Management section align with?
- Have you created a release version twice?
- Don't rush. Think about what is going on behind the scenes.

# Deliverable

Discuss what a release is and how they can be performed.

Discuss the benefits of plugins such as buildnumber and the benefits of Artifactory Maven repo settings for version control of artifacts.

Discuss with your group any difficulties you ran into, what worked well, and show off your completed deployment setup.
